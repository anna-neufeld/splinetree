---
title: "Forest Building with splinetree"
author: "Anna Neufeld"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Forest Intro}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 8
)
```

This guide is meant for users who are familiar with regression trees, random forests, and the spline projection method but who are unfamiliar with the specifics of using the ``splinetree`` package. The guide walks through examples of building and evaluating a spline forest. This guide builds off of the vignettes *Introduction to splinetree* and *Tree Building with splinetree*. The data used for these examples comes from the National Longitudinal Survey of Youth (NLSY), 1979. In the example, the trajectory of interest is body mass index (BMI) across age, and the split variables are baseline variables related to socioeconomic status and family background. 

# Building a Forest

If you are familiar with building trees in ``splinetree`` (see *Introduction to Tree Building with splinetree*), then building a forest is straightforward. The majority of the parameters needed to use the ``splineForest()`` function are identical to those used in the ``splineTree()`` function; the processed used to project the longitudinal data onto smoothed trajectories is identical. There are just two additional parameters for the ``splineForest`` function.

The ``nTree`` parameter specifies the number of trees in the forest. The default value is $50$. Large forests provide additional stability over smaller forests, but we note that on large datasets building a spline forest of size 50 will take a few minutes. For quick experimentation, it may be useful to build smaller forests. The ``prob`` parameter specifies the probability that a variable will be in consideration as a split variable at a given node. To avoid a situation where no variables are considered at a certain node, we recommend that that ``prob`` is relatively large when the number of split variables is small. If only 6 split variables are in consideration, then setting ``prob=1/3`` leaves around an 8\% chance ($\left( \frac{2}{3} \right)^6$) that no variable will be selected for a split at the root node. Increasing ``prob`` to ``1/2`` reduces this probability to under 2\%. 

Using the same $NLSY$ sample with the same  


Many forest performance metrics are based on the notion of 


The ``prob`` parameter specifies the 

Other built-in forest performance metrics have a similar parameter that can take on values of ``all`` (all trees are used for the prediction of every datapoint), ``itb`` (only trees for which this datapoint was in the bootstrap sample are used), or ``oob`` (only trees for which this datapoint was out of the bootstrap sample are used). For example, we can 


```{r, include=FALSE}
library(splinetree)
```

```{r}
set.seed(123)
splitform <- BMI~HISP+WHITE+BLACK+HGC_FATHER+Num_sibs+HGC_MOTHER+SEX+News+Mag+Lib
#forest <- splineForest(splitform, BMI~AGE, "ID", nlsySample, degree=1, df=2, intercept=FALSE, cp=0.001, ntree=50)
#intercept_forest <- splineForest(BMI~HISP+WHITE+BLACK+HGC_FATHER+Num_sibs+HGC_MOTHER+SEX+News+Mag+Lib, BMI~AGE, "ID", nlsySample, degree=1, df=3, intercept=TRUE, cp=0.001, ntree=50)
```

# Working with a Forest
 
- components of a forest object
- Prediction

# Evaluating a Forest

- R2 Y
- R2 Projected
- Oob vs itb vs. etc. 

# Variable Importance
- Show how to use function
- Show plot







